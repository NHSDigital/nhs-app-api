<TargetEndpoint name="nhs-app-target">
	<FaultRules>
		<FaultRule name="access_token_expired">
			<Step>
				<Name>ExtractVariables.OAuthErrorFaultString</Name>
			</Step>
			<Step>
				<Name>AssignMessage.OAuthPolicyErrorResponse</Name>
			</Step>
			<Condition>oauthV2.OauthV2.VerifyAccessToken.failed</Condition>
		</FaultRule>
	</FaultRules>
	<PreFlow>
		<Request>
			<Step>
				<Name>VerifyApiKey.XApiKey</Name>
			</Step>
			<Step>
				<Name>AssignMessage.RemoveApiKeyHeader</Name>
			</Step>
			<Step>
				<Name>KeyValueMap.GetUpstreamApiKey</Name>
			</Step>
			<Step>
				<Name>AssignMessage.AddUpstreamApiKeyHeader</Name>
			</Step>
			<Step>
				<Name>AssignMessage.AddHeader.NhsdCorrelationId</Name>
			</Step>
			<Step>
				<Name>AssignMessage.AddHeader.NhsdSupplierAppId</Name>
			</Step>
			<Step>
				<Name>AssignMessage.RemoveHeader.XCorrelationId</Name>
			</Step>
		</Request>
	</PreFlow>
	<HTTPTargetConnection>
		<SSLInfo>
			<Enabled>true</Enabled>
		</SSLInfo>
		<LoadBalancer>
			<Server name="nhs-app"/>
		</LoadBalancer>
	</HTTPTargetConnection>
</TargetEndpoint>
